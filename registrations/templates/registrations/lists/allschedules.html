{% extends 'pages/template.html' %}
{% load static %}

{% block content %}

<h4>Agendamentos {{datec}} | Para {{professionaldefault.first_name}}</h4>
    <hr>
<div class="row ml-auto">
    <div class="col-10">
        <form method="get" class="form-inline my-2 my-lg-0 mt-2" action="">
            <select class="form-control mr-3" name="id_professional" id="id_professional" onchange="this.form.submit()">
                {% for prof in professionals%}
                    {%if prof.id == professionaldefault.id%}
                        <option value={{prof.id}} selected>{{prof.first_name}}</option>
                    {%else%}
                        <option value={{prof.id}}>{{prof.first_name}}</option>
                    {%endif%}
                {% endfor %}
            </select>

            <input class="form-control mr-sm-2" type="date" aria-label="date" name="date" value={{date}} autofocus>
        </form>
    </div>
    <!-- <div class="col-sm">
        <form method="get" class="form-inline my-2 my-lg-0 mt-2" action="">
            <button class="btn btn-outline-success my-2 my-sm-0 btn-sm" value="2022-01-01" name="date" type="submit">Procurar </button>
        </form>
    </div> -->
    <div class="col-2">
        <a href="{% url 'create-appointment' %}?appdate={{datec}}&professional={{free.1.professional.id}}&client="
            class="btn btn-success">Encaixe</a>
    </div>
</div>
<div class="row pt-2 pb-auto">
    {% for item in feriados%}
    <div class="alert alert-danger ml-4" role="alert">
        {{item}}
    </div>
    {% endfor %}
</div>
<div class="table-responsive">
    <table class="table table-striped table-sm">
        <tr>
            <th>Horário</th>
            <th>Cliente</th>
            <th>Whats</th>
            <th>Status</th>
            <th>Procedimento</th>
            <th>Valor</th>
            <th>Pago</th>
            <th>Opções</th>
        </tr>

        {% for obj in free %}
        <tr>
            <td>{{obj.apphour}}</td>

            <td title="{{obj.client.name}}">
                {% if obj.pk %}
                {{obj.client.name.split.0}} {{obj.client.name.split.1}}
                {%else%}

                <a href="{% url 'create-appointment' %}?appdate={{obj.appdate}}&apphour={{obj.apphour}}&professional={{obj.professional.id}}"
                    class="btn btn-success btn-sm">Inserir</a>
                {% endif%}
            </td>
            <td><a href="https://api.whatsapp.com/send?phone=55{{obj.client.tel}}&text=Olá temos um Agendamento dia {{obj.appdate}} as {{obj.apphour}} com {{obj.professional.first_name}}"
                    target="_blank">
                    {{obj.client.tel}}</a>
            </td>
            <td>{{obj.get_status_display}}</td>
            <td>{{obj.procedure.name}}</td>
            <td>{{obj.total}}</td>
            <td>{{obj.get_payed_display}}</td>

            <td>
                {% if obj.pk %}
                <a href="{% url 'edit-appointment' obj.pk %}" class="btn btn-warning btn-sm"><i class="bi bi-pencil"></i></i></a>

                {% if obj.status == '0'%}
                <a href="{% url 'allschedules' %}?idappointment={{obj.pk}}&newstatus=1&date={{date}}" class="btn btn-info btn-sm">Confirmar</a>
                <a href="{% url 'allschedules' %}?idappointment={{obj.pk}}&newstatus=6&date={{date}}" class="btn btn-warning btn-sm">Cancelar</a>
                {%endif%}
                {% if obj.status == '1'%}
                <a href="{% url 'allschedules' %}?idappointment={{obj.pk}}&newstatus=2&date={{date}}" class="btn btn-info btn-sm">Chegou</a>
                <a href="{% url 'allschedules' %}?idappointment={{obj.pk}}&newstatus=5&date={{date}}" class="btn btn-warning btn-sm">Faltou</a>
                {%endif%}
                {% if obj.status == '2'%}
                <a href="{% url 'allschedules' %}?idappointment={{obj.pk}}&newstatus=3&date={{date}}" class="btn btn-info btn-sm">Atender</a>

                {%endif%}
                {% if obj.status == '3'%}
                <a href="{% url 'allschedules' %}?idappointment={{obj.pk}}&newstatus=4&date={{date}}&payedstatus=S" class="btn btn-info btn-sm">Atendido e Pago</a>
                <a href="{% url 'allschedules' %}?idappointment={{obj.pk}}&newstatus=4&date={{date}}&payedstatus=N" class="btn btn-info btn-sm">Atendido</a>
                {%endif%}


                {%if  obj.status != '4'%}
                <a href="{% url 'delete-appointment' obj.pk %}" class="btn btn-danger btn-sm"><i class="bi bi-trash"></i></a>
                {% endif%}

                {%else%}
                {% endif%}
            </td>

        </tr>
        {% empty %}
        <tr>
            <td colspan="3">
                Olá, você não possuí cadastro de <a href="{% url 'list-schedule' %}">HORÁRIOS</a> adicione para
                completar sua agenda
            </td>
        </tr>
        {% endfor %}

    </table>
</div>
{% endblock %}

{% block scripts %}

<script>
    $('input[type=date]').change(function () {
        this.form.submit();
    });

    $('input[type=date]').keypress(function (e) {
        $(this).off('change blur');

        $(this).blur(function () {
            this.form.submit();
        });

        if (e.keyCode === 13) {
            this.form.submit();
        }
    });

</script>


{% endblock %}